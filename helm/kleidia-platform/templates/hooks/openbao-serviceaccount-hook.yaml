{{- if .Values.openbao.enabled }}
---
# ============================================================================
# OpenBao Pre-Install Hook - ServiceAccount Creation
# ============================================================================
#
# This hook runs BEFORE the token secret hook to ensure the ServiceAccount
# exists when Kubernetes tries to create the token secret.
#
# Hook Weight: -15 (runs before openbao-pre-install.yaml which is -10)
#
# Background:
# - The openbao-token Secret requires the openbao ServiceAccount to exist
# - Pre-install hooks run before regular resources
# - We must create the ServiceAccount in a pre-install hook
#   so it exists when the token secret hook runs
#
# ============================================================================
apiVersion: v1
kind: ServiceAccount
metadata:
  name: openbao
  namespace: {{ .Values.global.namespace }}
  annotations:
    helm.sh/hook: pre-install,pre-upgrade
    helm.sh/hook-weight: "-15"
    # No delete policy - ServiceAccount should persist after hook
{{- end }}

